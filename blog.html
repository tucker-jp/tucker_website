<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Writing — Tucker Pippin</title>
    <meta name="description" content="Thoughts, updates, and shorter pieces from Tucker Pippin.">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- Background photo rails (desktop only) -->
    <div class="photo-rails">
        <div class="rail rail-left">
            <img src="/uploads/blog_bumper_1.jpg" alt="">
        </div>
        <div class="rail rail-right">
            <img src="/uploads/blog_bumper_2.jpg" alt="">
        </div>
    </div>

    <nav class="site-nav">
        <div class="nav-container">
            <a href="/" class="site-title">Tucker Pippin</a>
            <div class="nav-links">
                <a href="/photos.html">Photos</a>
                <a href="/projects.html">Projects</a>
                <a href="/blog.html" class="active">Writing</a>
                <a href="/admin" class="admin-link">Login</a>
                <span class="contact-link" id="contact-btn">Contact</span>
            </div>
        </div>
    </nav>

    <main class="container">
        <header class="page-header">
            <h1>Writing</h1>
            <p class="page-intro">Shorter thoughts, updates, and things worth sharing.</p>

            <!-- Taleb Quote -->
            <div class="photo-quote quote-box">
                <p class="photo-quote-text">"The minute I was bored with a book or a subject I moved to another one, instead of giving up on reading altogether...</p>
                <p class="photo-quote-text" style="margin-top: 0.5rem;">The trick is to be bored with a specific book, rather than with the act of reading. So the number of the pages absorbed could grow faster than otherwise. And you find gold, so to speak, effortlessly, just as in rational but undirected trial-and-error-based research...</p>
                <p class="photo-quote-text" style="margin-top: 0.5rem;">Trial and error is freedom."</p>
                <p class="photo-quote-author">— Nassim Taleb</p>
            </div>

            <!-- Reading Time Filters -->
            <div class="blog-filters">
                <button class="filter-btn active" data-filter="all">All Posts</button>
                <button class="filter-btn" data-filter="short">Short Reads (< 10 min)</button>
                <button class="filter-btn" data-filter="long">Long Reads (≥ 10 min)</button>
            </div>
        </header>

        <div id="blog-feed" class="blog-feed">
            <p class="loading">Loading posts...</p>
        </div>
    </main>

    <footer class="site-footer">
        <p>&copy; 2025 Tucker Pippin. All rights reserved.</p>
    </footer>

    <!-- Contact Modal -->
    <div id="contact-modal" class="contact-modal">
        <div class="contact-modal-content">
            <h3>Get in Touch</h3>
            <p>Send me an email at:</p>
            <div class="email-display" id="email-display">tuckerepippin@gmail.com</div>
            <div class="contact-modal-buttons">
                <button class="copy-email-btn" id="copy-email-btn">Copy Email</button>
                <button class="close-modal-btn" id="close-modal-btn">Close</button>
            </div>
        </div>
    </div>

    <script src="/js/utils.js"></script>
    <script src="/content-loader.js"></script>
    <script>
        const POSTS_PER_PAGE = 10;
        const WORD_LIMIT = 250;
        let allPosts = [];
        let currentFilter = 'all';

        window.addEventListener('DOMContentLoaded', async () => {
            await loadBlogFeed();
            setupFilters();
        });

        async function loadBlogFeed() {
            const container = document.getElementById('blog-feed');

            try {
                const posts = await loadCollection('blog');

                if (posts.length === 0) {
                    container.innerHTML = '<p class="empty">No blog posts yet.</p>';
                    return;
                }

                // Load full content for first 10 posts
                const recentPosts = posts.slice(0, POSTS_PER_PAGE);
                const fullPosts = await Promise.all(
                    recentPosts.map(post => loadSingleContent('blog', post.slug))
                );

                allPosts = fullPosts;
                renderPosts(fullPosts);

            } catch (error) {
                console.error('Error loading blog feed:', error);
                container.innerHTML = '<p class="error">Unable to load posts.</p>';
            }
        }

        function truncateToWords(html, wordLimit) {
            const temp = document.createElement('div');
            temp.innerHTML = html;
            const text = temp.textContent || temp.innerText || '';
            const words = text.trim().split(/\s+/);

            if (words.length <= wordLimit) {
                return { html, isTruncated: false };
            }

            const truncatedText = words.slice(0, wordLimit).join(' ');
            return { html: truncatedText + '...', isTruncated: true };
        }

        function cleanPlaceholderText(html) {
            // Remove placeholder characters like \-, \n-, -\n, or standalone -
            // that appear as the only content or at the start of content
            if (!html) return '';

            // Trim whitespace
            let cleaned = html.trim();

            // Remove if content is just a placeholder
            if (cleaned === '-' || cleaned === '\\-' || cleaned === '\n-' || cleaned === '-\n') {
                return '';
            }

            // Remove leading placeholder patterns
            cleaned = cleaned.replace(/^\\-\s*/, '');
            cleaned = cleaned.replace(/^-\s*$/, '');

            // If after cleaning there's nothing meaningful left, return empty
            if (cleaned.length <= 2) {
                return '';
            }

            return cleaned;
        }

        function renderPosts(posts) {
            const container = document.getElementById('blog-feed');

            container.innerHTML = posts.map((post, index) => {
                let coverImageHtml = '';
                if (post.cover_image) {
                    coverImageHtml = `<img src="${escapeHtml(post.cover_image)}" alt="${escapeHtml(post.title)}" class="blog-post-image">`;
                }

                // Clean placeholder text from post HTML
                const cleanedHtml = cleanPlaceholderText(post.html);

                const { html: truncatedContent, isTruncated } = truncateToWords(cleanedHtml, WORD_LIMIT);
                const expandBtnHtml = isTruncated ?
                    `<button class="read-more-btn" data-post-index="${index}">Read Further</button>` : '';

                return `
                    <article class="blog-post-full" data-reading-time="${post.readingTime}">
                        <h2 class="blog-post-title">${escapeHtml(post.title)}</h2>
                        <div class="post-meta">
                            <span>by Tucker Pippin</span>
                            <span class="separator">•</span>
                            <time>${formatDate(post.date)}</time>
                            <span class="separator">•</span>
                            <span class="reading-time">${post.readingTime} min read</span>
                        </div>
                        ${coverImageHtml}
                        <div class="post-content" id="post-content-${index}">
                            ${truncatedContent}
                        </div>
                        <div class="full-content" id="full-content-${index}" style="display: none;">
                            ${cleanedHtml}
                        </div>
                        ${expandBtnHtml}
                    </article>
                `;
            }).join('');

            // Add click handlers for expand buttons
            document.querySelectorAll('.read-more-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = this.getAttribute('data-post-index');
                    const truncatedDiv = document.getElementById(`post-content-${index}`);
                    const fullDiv = document.getElementById(`full-content-${index}`);

                    if (fullDiv.style.display === 'none') {
                        truncatedDiv.style.display = 'none';
                        fullDiv.style.display = 'block';
                        this.textContent = 'Show Less';
                    } else {
                        truncatedDiv.style.display = 'block';
                        fullDiv.style.display = 'none';
                        this.textContent = 'Read Further';
                    }
                });
            });
        }

        function setupFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');

            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active state
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');

                    // Get filter type
                    const filter = this.getAttribute('data-filter');
                    currentFilter = filter;

                    // Filter posts
                    let filteredPosts = allPosts;
                    if (filter === 'short') {
                        filteredPosts = allPosts.filter(post => post.readingTime < 10);
                    } else if (filter === 'long') {
                        filteredPosts = allPosts.filter(post => post.readingTime >= 10);
                    }

                    renderPosts(filteredPosts);
                });
            });
        }
    </script>
    <script src="/js/contact-modal.js"></script>

    <!-- Instant page navigation - preloads links on hover -->
    <script src="//instant.page/5.2.0" type="module" data-instant-intensity="mousedown"></script>
</body>
</html>
