<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>

  <!-- Mobile-responsive CSS for Decap CMS -->
  <style>
    @media (max-width: 768px) {
      /* Increase button sizes for better touch targets */
      button, .nc-button, [class*="Button"] {
        min-height: 44px !important;
        min-width: 44px !important;
        padding: 12px 20px !important;
        font-size: 16px !important;
      }

      /* Larger input fields to prevent iOS auto-zoom */
      input, textarea, select {
        font-size: 16px !important;
        padding: 12px !important;
        min-height: 44px !important;
      }

      /* Full-width sidebar on mobile */
      [class*="sidebar"], [class*="Sidebar"] {
        width: 100% !important;
        position: relative !important;
      }

      /* Stack toolbar controls vertically */
      [class*="toolbar"], [class*="Toolbar"] {
        flex-direction: column !important;
        gap: 8px !important;
      }

      /* Improve modal dialogs */
      [class*="modal"], [class*="Modal"] {
        padding: 16px !important;
        max-width: 95vw !important;
      }

      /* Better spacing for collection entries */
      [class*="card"], [class*="Card"] {
        margin-bottom: 12px !important;
        padding: 12px !important;
      }

      /* Improve list items and collection cards */
      [class*="listCard"], [class*="ListCard"] {
        padding: 12px !important;
        margin-bottom: 8px !important;
      }

      /* Better spacing for form fields */
      [class*="field"], [class*="Field"] {
        margin-bottom: 16px !important;
      }

      /* Improve widget controls */
      [class*="widget"], [class*="Widget"] {
        padding: 8px !important;
      }
    }
  </style>
</head>
<body>
  <!-- Include the Decap CMS script -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

  <!-- Custom photo preview template -->
  <script>
    var PhotoPreview = createClass({
      render: function() {
        const entry = this.props.entry;
        const photo = entry.getIn(['data', 'photo']);
        const title = entry.getIn(['data', 'title']) || 'Untitled';
        const caption = entry.getIn(['data', 'caption']);
        const location = entry.getIn(['data', 'location']);
        const description = entry.getIn(['data', 'description']);
        const isMine = entry.getIn(['data', 'is_mine']);

        // Handle in-memory uploads using getAsset
        const imageUrl = this.props.getAsset(photo);
        const imageSrc = imageUrl ? imageUrl.toString() : photo;

        return h('div', { style: 'padding: 20px; font-family: Inter, sans-serif; max-width: 800px; margin: 0 auto;' },
          h('h1', { style: 'font-family: Lora, serif; font-size: 2rem; margin-bottom: 1rem; color: #2a2520;' }, title),
          imageSrc ?
            h('img', {
              src: imageSrc,
              alt: title,
              style: 'max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(42, 37, 32, 0.1);',
              onError: function(e) {
                e.target.style.display = 'none';
                e.target.insertAdjacentHTML('afterend', '<p style="color: #a85448; padding: 20px; background: #fef3f2; border-radius: 8px; border: 1px solid #fecdca;">‚ö†Ô∏è Image preview failed. This may be an unsupported format (HEIC) or the file is too large. Try converting to JPEG before uploading.</p>');
              }
            }) :
            h('p', { style: 'color: #8a857f; font-style: italic; padding: 40px; text-align: center; background: #faf8f3; border-radius: 8px;' }, 'No image selected'),
          caption ? h('p', { style: 'font-size: 1.125rem; color: #5a5550; margin-bottom: 0.5rem; line-height: 1.6;' }, caption) : null,
          location ? h('p', { style: 'color: #6b5d52; margin-bottom: 0.5rem; font-weight: 500;' }, 'üìç ' + location) : null,
          description ? h('p', { style: 'color: #2a2520; line-height: 1.7; margin-top: 1rem;' }, description) : null,
          h('p', { style: 'font-size: 0.875rem; color: #8a857f; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e8e4da;' },
            isMine ? '‚úì Your photo' : '‚Ñó Not your photo')
        );
      }
    });

    CMS.registerPreviewTemplate('photos', PhotoPreview);
  </script>
</body>
</html>
