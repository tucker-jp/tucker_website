<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>

  <!-- Mobile-responsive CSS for Decap CMS -->
  <style>
    @media (max-width: 768px) {
      /* Increase button sizes for better touch targets */
      button, .nc-button, [class*="Button"] {
        min-height: 44px !important;
        min-width: 44px !important;
        padding: 12px 20px !important;
        font-size: 16px !important;
      }

      /* Larger input fields to prevent iOS auto-zoom */
      input, textarea, select {
        font-size: 16px !important;
        padding: 12px !important;
        min-height: 44px !important;
      }

      /* Full-width sidebar on mobile */
      [class*="sidebar"], [class*="Sidebar"] {
        width: 100% !important;
        position: relative !important;
      }

      /* Stack toolbar controls vertically */
      [class*="toolbar"], [class*="Toolbar"] {
        flex-direction: column !important;
        gap: 8px !important;
      }

      /* Improve modal dialogs */
      [class*="modal"], [class*="Modal"] {
        padding: 16px !important;
        max-width: 95vw !important;
      }

      /* Better spacing for collection entries */
      [class*="card"], [class*="Card"] {
        margin-bottom: 12px !important;
        padding: 12px !important;
      }

      /* Improve list items and collection cards */
      [class*="listCard"], [class*="ListCard"] {
        padding: 12px !important;
        margin-bottom: 8px !important;
      }

      /* Better spacing for form fields */
      [class*="field"], [class*="Field"] {
        margin-bottom: 16px !important;
      }

      /* Improve widget controls */
      [class*="widget"], [class*="Widget"] {
        padding: 8px !important;
      }
    }
  </style>
</head>
<body>
  <!-- Include the Decap CMS script -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

  <!-- Custom photo preview template -->
  <script>
    var PhotoPreview = createClass({
      render: function() {
        var entry = this.props.entry;
        var getAsset = this.props.getAsset;

        // Safely get values as strings
        var photo = entry.getIn(['data', 'photo']);
        var title = entry.getIn(['data', 'title']);
        var caption = entry.getIn(['data', 'caption']);
        var location = entry.getIn(['data', 'location']);
        var description = entry.getIn(['data', 'description']);
        var isMine = entry.getIn(['data', 'is_mine']);

        // Convert to safe string values
        title = title ? String(title) : 'Untitled';
        caption = caption ? String(caption) : '';
        location = location ? String(location) : '';
        description = description ? String(description) : '';

        // Build image source
        var imageSrc = null;
        if (photo) {
          var asset = getAsset(photo);
          if (asset) {
            imageSrc = asset.toString();
          } else {
            imageSrc = String(photo);
          }
        }

        // Build children array
        var children = [
          h('h1', { style: 'font-family: Lora, serif; font-size: 2rem; margin-bottom: 1rem; color: #2a2520;' }, title)
        ];

        // Add image or placeholder
        if (imageSrc) {
          children.push(
            h('img', {
              src: imageSrc,
              alt: title,
              style: 'max-width: 100%; height: auto; border-radius: 8px; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(42, 37, 32, 0.1);'
            })
          );
        } else {
          children.push(
            h('p', { style: 'color: #8a857f; font-style: italic; padding: 40px; text-align: center; background: #faf8f3; border-radius: 8px;' }, 'No image selected')
          );
        }

        // Add optional fields
        if (caption) {
          children.push(h('p', { style: 'font-size: 1.125rem; color: #5a5550; margin-bottom: 0.5rem; line-height: 1.6;' }, caption));
        }
        if (location) {
          children.push(h('p', { style: 'color: #6b5d52; margin-bottom: 0.5rem; font-weight: 500;' }, 'üìç ' + location));
        }
        if (description) {
          children.push(h('p', { style: 'color: #2a2520; line-height: 1.7; margin-top: 1rem;' }, description));
        }

        // Add ownership indicator
        children.push(
          h('p', { style: 'font-size: 0.875rem; color: #8a857f; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e8e4da;' },
            isMine ? '‚úì Your photo' : '‚Ñó Shared with permission, public domain, or similar license')
        );

        return h('div', { style: 'padding: 20px; font-family: Inter, sans-serif; max-width: 800px; margin: 0 auto;' }, children);
      }
    });

    CMS.registerPreviewTemplate('photos', PhotoPreview);
  </script>
</body>
</html>
